      SUBROUTINE XCTAE_IPARS(NSMOOTH)
      IMPLICIT NONE
C
C_TITLE	XCTAE_IPARS - Get iteration params from TAE for clinometry progs
C
C_ARGS	TYPE      	VARIABLE 	I/O	DESCRIPTION
	INTEGER*4	NSMOOTH		!O	+ve=3x3 boxcar NSMOOTH
C						    times before iteration
C						-ve=boxcar until residuals
C						    stop decreasing
C						0=no preliminary boxcar
C
C_DESC	Calls TAE to get the values of the parameters controlling iteration.
C
C_CALLS XRINTG,XRREAL (TAE)
C
C_HIST	02-Mar-91 Randolph Kirk U.S.G.S. Flagstaff Original Version
C
C_PAUSE
C
#include "clinom_ipars.inc"
      INTEGER*4 ICOUNT,ISTAT	! Needed for TAE input
      INTEGER*4 HALFBOX(2)	! Halfwidths of despike filter (NDS
C				  is fullwidths)
      INTEGER*4 ERRVAL          ! Error code
      CHARACTER ERRKEY*17       ! Keyword value for error message
      CHARACTER ERRMSG*80       ! Error message
      CHARACTER STR*132         ! String for reporting information

C      CALL U_GET_INT_PARM('NSMOOTH',1,NSMOOTH,ICOUNT,ISTAT)
C      IF (ISTAT.NE.0) GOTO 9000
      NSMOOTH=0
      CALL U_GET_REAL_PARM('ALPHA',1,1,5,AL,ICOUNT,ISTAT)
      IF (ISTAT.NE.0) GOTO 9000
      AL=1.0/AL
      CALL U_GET_REAL_PARM('ALPHAASYM',1,1,5,ALASYM,ICOUNT,ISTAT)
      IF (ISTAT.NE.0) GOTO 9000
      ALASYM=1.0/ALASYM
      CALL U_GET_REAL_PARM('STEPASYM',1,1,5,ALRAT,ICOUNT,ISTAT)
      IF (ISTAT.NE.0) GOTO 9000
      IF (ALRAT.GE.1.0E6) THEN
        ALRAT=1.0
      ELSE
        ALRAT=EXP(-1.0/ALRAT)
      ENDIF
C      CALL U_GET_REAL_PARM('CONTRAST',1,1,5,CONTRAST,ICOUNT,ISTAT)
C      IF (ISTAT.NE.0) GOTO 9000
      CONTRAST=1.0
      CALL U_GET_REAL_PARM('WMAX',1,1,5,WMAX,ICOUNT,ISTAT)
      IF (ISTAT.NE.0) GOTO 9000
      CALL U_GET_REAL_PARM('DIVTOL',1,1,5,DIVTOL,ICOUNT,ISTAT)
      IF (ISTAT.NE.0) GOTO 9000
C      DIVTOL=1.0E30
      CALL U_GET_INT_PARM('ITMAX',1,ITMAX,ICOUNT,ISTAT)
      IF (ISTAT.NE.0) GOTO 9000
C      CALL U_GET_REAL_PARM('DDZTOL',1,1,5,DDZTOL,ICOUNT,ISTAT)
C      IF (ISTAT.NE.0) GOTO 9000
      DDZTOL=1.0/REAL(ITMAX)
      CALL U_GET_REAL_PARM('ETOL',1,1,5,ETOL,ICOUNT,ISTAT)
      IF (ISTAT.NE.0) GOTO 9000
      CALL U_GET_REAL_PARM('BIGTOL',1,1,5,BIGTOL,ICOUNT,ISTAT)
      IF (ISTAT.NE.0) GOTO 9000
C      BIGTOL=0.1
      CALL U_GET_REAL_PARM('OLDTOL',1,1,5,OLDTOL,ICOUNT,ISTAT)
      IF (ISTAT.NE.0) GOTO 9000
C      OLDTOL=0.0
      CALL U_GET_INT_PARM('DEPTHLIM',1,DEPTHLIM,ICOUNT,ISTAT)
      IF (ISTAT.NE.0) GOTO 9000
C      DEPTHLIM=0
C      CALL U_GET_INT_PARM('HALFBOX',2,HALFBOX,ICOUNT,ISTAT)
C      IF (ISTAT.NE.0) GOTO 9000
      HALFBOX(1)=1
      HALFBOX(2)=1
C      NDS(1)=HALFBOX(1)+HALFBOX(1)-1
C      NDS(2)=HALFBOX(2)+HALFBOX(2)-1
      NDS(1)=1
      NDS(2)=1
C      CALL U_GET_REAL_PARM('STD',2,1,5,STD,ICOUNT,ISTAT)
C      IF (ISTAT.NE.0) GOTO 9000
      STD(1)=0.0
      STD(2)=0.0
C      CALL U_GET_INT_PARM('MAXPASS',1,MAXPASS,ICOUNT,ISTAT)
C      IF (ISTAT.NE.0) GOTO 9000
      MAXPASS=-1
C      CALL U_GET_REAL_PARM('CPULIMIT',1,1,5,CPULIMIT,ICOUNT,ISTAT)
C      IF (ISTAT.NE.0) GOTO 9000
C      CALL U_GET_INT_PARM('MAXNR',1,MAXNR,ICOUNT,ISTAT)
C      IF (ISTAT.NE.0) GOTO 9000
      WEIGHT0=0.0	! A priori weights not currently supported
   21 FORMAT (A,:,A,:,',',A)
   22 FORMAT(A,I6,:,',',I6)
   23 FORMAT(A,1PG14.7,:,',',G14.7)
C      WRITE (STR,22) 'NSMOOTH= ',NSMOOTH
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,23) 'ALPHA= ',1.0/AL
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,23) 'CONTRAST= ',CONTRAST
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,23) 'WMAX= ',WMAX
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,23) 'DIVTOL= ',DIVTOL
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,22) 'ITMAX= ',ITMAX
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,23) 'DDZTOL= ',DDZTOL
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,23) 'ETOL= ',ETOL
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,23) 'BIGTOL= ',BIGTOL
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,23) 'OLDTOL= ',OLDTOL
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,22) 'DEPTHLIM= ',DEPTHLIM
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,22) 'HALFBOX= ',HALFBOX
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,23) 'STD= ',STD
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,22) 'MAXPASS= ',MAXPASS
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,23) 'CPULIMIT= ',CPULIMIT
C      CALL U_WRITE_MSG(3,STR)
C      WRITE (STR,22) 'MAXNR= ',MAXNR
C      CALL U_WRITE_MSG(3,STR)
      RETURN
C
C Handle processing errors
C
9000  CONTINUE
      ERRKEY = 'XCTAE_IPARS-TAE'
      ERRMSG = 'Error reading TAE parameters from user input'
      ERRVAL = -1
      GOTO 9999
C
C Write an error message
C
9999  CONTINUE
      CALL U_ERROR(ERRKEY,ERRMSG,ERRVAL,1)
      RETURN
      END
